----
<b>Table of contents:</b>

<<<!-- ! TOC here -->(2)>>
----

= Speed benchmarks =

== Initial patchbomb comparison with Mercurial ==

On Mon, Apr 25, 2005 at 07:08:28PM -0700, Linus Torvalds wrote:<<BR>>
> <<BR>>
> To make an interesting benchmark, try applying the first 200 patches in<<BR>> 
> the current git kernel archive. Can you do them three per second? THAT is<<BR>> 
> the thing you should optimize for, not checking in huge changes.<<BR>>

Ok, I've optimized for it a bit. This is basically:

<pre><nowiki>
 hg import -p1 -b ../broken-out `cat ../broken-out | grep -v #`
</nowiki></pre>

My benchmark is to apply all 819 patches from -mm3 to 2.6.12-rc:

 hg (Mercurial 0.4b)::

  ||real   || 3m22.075s ||
  ||user   || 1m57.195s ||
  ||sys    || 0m14.068s ||

 819/(60+57.195 + 14.068) = 6.239 patches/second  user+sys<<BR>>
 repository: before 167M after 173M (3.5% growth)

 git (version unknown, as of April 29, 2005)::

  ||real   || 2m58.568s ||
  ||user   || 1m11.196s ||
  ||sys    || 0m50.144s ||

 819/(60+11.196+50.144) = 6.750 patches/second  user+sys<<BR>>
 repository: before 102M after 154M (51% growth)

<b>Reference:</b> [http://marc.theaimsgroup.com/?l=git&m=111475459526688 Mercurial 0.4b vs git patchbomb benchmark] by Matt Mackall, via [[WikiPedia:Git_(software)|Git (software)]] article at Wikipedia.

== Old Bazaar-NG versus Git comparison ==

Comparison using linux-2.6.0 and linux-2.6.15.4 as a large source tree to use.

 real::
 || <b>Operation</b>    ||`bzr (0.7pre)`||`git (0.99.9c)`||
 || init               ||<)>    1.593s ||<)>    0.161s  ||
 || add 2.6.0          ||<)>   31.870s ||<)>   42.121s  ||
 || diff 2.6.15.4      ||<)> 1m13.869s ||<)> 2m26.982s  ||
 || initial commit     ||<)> 2m 4.757s ||<)>   54.964s  ||
 || diff no changes    ||<)> 3m51.918s ||<)>    0.057s  ||
 || status no changes  ||<)>   19.711s ||<)>    0.442s  ||
 || commit one file    ||<)> 2m 6.685s ||<)>    7.364s  ||

 user+sys::
 || <b>Operation</b>    ||`bzr (0.7pre)`||`git (0.99.9c)`||
 || init               ||<)>    0.187s ||<)>    0.006s  ||
 || add 2.6.0          ||<)>   31.592s ||<)>   35.636s  ||
 || diff 2.6.15.4      ||<)>   29.028s ||<)> 2m28.000s  ||
 || initial commit     ||<)> 1m22.773s ||<)>   53.016s  ||
 || diff no changes    ||<)>    9.186s ||<)>    0.056s  ||
 || status no changes  ||<)>   16.358s ||<)>    0.458s  ||
 || commit one file    ||<)>   35.192s ||<)>    7.366s  ||

Note that `git-add` adds contents of a file to repository, and not only marks file for later commit.

Note also discrepancy between real and user+sys for "bzr diff" comparing imported linux-2.6.0 with linux-2.6.15.4 in working tree (1m13.869s vs 29.028s), "bzr commit" for initial commit (2m4.757s vs 1m22.773s), "bzr diff" for no changes (3m51.918s vs 9.186s) and "bzr commit" with singe file change (2m6.685s vs 35.192s) in original reference (link below).

<b>Reference:</b> [http://blog.jozilla.net/2006/3/3/bzr-versus-git Bzr versus git] from March 3rd, 2006 on Jo Vermeulen blog (mentioned [http://en.wikipedia.org/wiki/Talk:Git_%28software%29 Talk:Git (software)] page on Wikipedia).

== Quilt import comparison of Git and Mercurial ==

* commit 773 patches (20MB) for 2.6.18-rc1 to-mm2
* 1.8GHz AMD64 laptop, 1.2GB of RAM, freshly formatted ext3 filesystem, data=writeback,noatime

<b>Mercurial (version unknown)</b> (probably latest at that time)
<pre><nowiki>
 $ hg qpush -a 2.6.18-rc1-mm2
</nowiki></pre>

 ||real    || 1m18.398s  ||
 ||user    || 0m42.511s  ||
 ||sys     || 0m10.105s  ||

 773/(42.511+10.105) = 14.691 patches/second  user+sys

<b>Git 1.4.1</b>
<pre><nowiki>
 $ git-quilt-import 2.6.18-rc1-mm2
</nowiki></pre>

 ||real    || 2m7.701s   ||
 ||user    || 1m15.953s  ||
 ||sys     || 0m30.186s  ||

 773/(60+15.953+30.186) = 7.282 patches/second  user+sys

<b>Reference:</b> Talk by mpm (Matt Mackall), the primary Mercurial author: [http://www.linuxsymposium.org/2006/view_abstract.php?content_key=194 Towards A Better SCM: Revlogs and Mercurial] at [http://www.linuxsymposium.org/2006/ 2006 Ottawa Linux Symposium]. Slides: [http://www.selenic.com/mercurial/wiki/index.cgi/Presentations?action=AttachFile&do=get&target=ols-mercurial.pdf PDF] [http://www.selenic.com/mercurial/wiki/index.cgi/Presentations?action=AttachFile&do=get&target=ols-mercurial.odp ODP] (page 51 of 52).

== Clone/status/pull comparison of Git and Mercurial ==

On Tue, May 23, 2006 in [http://lists.ibiblio.org/pipermail/sm-discuss/2006-May/014586.html |SM-Discuss| scm next steps] post Jeremy Blosser did speed benchmarks with hg vs. git.  The post contains fairly large table of results. Here's the summary, where all times are given in seconds, and are user+sys time averaged over all results and all cases:

{| border="1" cellpadding="2" cellspacing="0"
|rowspan="2" | tool 
|colspan="3" |     clone         
|colspan="2" |   status   
|colspan="2" |      log      
|colspan="2" |   pull/merge    
| 
|-
|align="center" |          local    
|align="center" |ssh     
|align="center" |  http  
|align="center" | test 
|align="center" | full 
|align="center" | log  
|align="center" |log -p
|align="center" |server
|align="center" | workst. 
| 
|-
|  git      
|align="right" | 9,529s
|align="right" | 14,020s
|align="right" | 36,820s
|align="right" |0,723s
|align="right" |1,893s
|align="right" |0,380s
|align="right" |20,005s  
|align="right" |165,494s
|align="right" |479,750s 
| 
|-
|  hg       
|align="right" |53,783s
|align="right" |109,052s
|align="right" |109,305s
|align="right" |1,857s
|align="right" |4,167s
|align="right" |6,020s
| (stopped)
|align="right" | 48,992s
|align="right" |108,150s 
| 
|}

Git repository has all 4 branches in one repository, Mercurial (hg) had one repository per branch; `git log` is for git_p4 with only 2 branches.

As it can be easily seen Git is faster than Mercurial in all tested areas except pull/merge, where it is around 4 times slower.

<b>Reference:</b> [http://lists.ibiblio.org/pipermail/sm-discuss/2006-May/014586.html |SM-Discuss| scm next steps] by Jeremy Blosser.

== Diff comparison of Git, Mercurial and Bazaar-NG ==

Tests were made on the whole Mozilla tree, with one-line change to one file. All numbers are best of 3 runs, back to back on the same mostly idle computer.

 || <b>Operation</b>         ||`bzr (0.12.0c1)`||`hg (0.9)` ||`git (1.4.2.4)` ||
 || diff (top level)        ||<)> 16.957      ||<)> 5.600  ||<)> 1.572       ||
 || diff dom/               ||<)> 10.596      ||<)> 2.240  ||<)> 0.140       ||
 || diff in dom             ||<)> 16.833      ||<)> 5.548  ||<)> 0.136       ||
 || diff <i>changed file</i>   ||<)> 10.472      ||<)> 2.084  ||<)> 0.116       ||
 || diff <i>unchanged file</i> ||<)> 10.012      ||<)> 2.024  ||<)> 0.088       ||

<b>Reference:</b> [http://weblogs.mozillazine.org/jst/archives/2006/11/vcs_performance.html Jst's Blog: bzr/hg/git performance].

== Comparison of Bazaar-NG, Darcs, Git and Mercurial ==

Tests were made using a directory with 266 MB of files, 258 KB of which were text files, with the rest being image files (not very typical but reflects nature of author's repository).  Here's a table summarizing the real times reported by time(1):

 ||<|2><b>Tool</b> ||<:><b>initialize</b>||<:><b>initial</b>||<:><b>initial</b>||<:><b>branch/clone</b>||<:><b>non-conflicting</b>||<|2><b>total</b>||
 ||<:><b>repository</b>||<:><b>file import</b>||<:><b>commit</b>||<:><b>repository</b>||<:><b>merge</b>  ||||
 ||bzr  ||<)>0m1.144s||<)> 0m0.839s ||<)>1m7.836s ||<)>0m31.145s||<)>0m1.154s||<)> 1m42.118s||
 ||darcs||<)>0m0.429s||<)>12m50.321s||<)>0m0.164s ||<)>0m5.691s ||<)>0m6.717s||<)>13m3.322s||
 ||git  ||<)>0m0.081s||<)> 1m1.918s ||<)>0m6.679s ||<)>1m37.630s||<)>0m1.910s||<)> 2m48.218s||
 ||hg   ||<)>0m0.781s||<)> 0m0.377s ||<)>0m49.015s||<)>0m8.831s ||<)>0m0.342s||<)>   59.356s||

As you can see, Mercurial (`hg`) was the fastest.  The fact that Mercurial outerforms Git is probably caused by the fact that Git just doesn't handle the binary files as well, although there were some patches lately dealing with overly-big blobs.

<b>References:</b> 
* [http://bryan-murdock.blogspot.com/2007/03/cutting-edge-revision-control.html Cyclopedia Square: Cutting Edge Revision Control], blog by Bryan Murdock, at Saturday, March 3, 2007.
* [http://thread.gmane.org/gmane.comp.version-control.git/54382 Git benchmark - comparison with Bazaar, Darcs, Git and Mercurial] thread at git mailing list.

= Repository size benchmarks =

== --window and --depth parameters ==
A Blogpost about [http://vcscompare.blogspot.com/2008/06/git-repack-parameters.html Git repack parameters] mentions that most repositories should be ok with a window value of 50 for a complete repack. Really large repositories might benefit from a higher value. The --depth parameter becomes insignificant when a large window value is used.

== Estimate size of Linux kernel repository ==

The historic Linux repo currently repacks itself into a ~175MB pack for 
63428 commits.

The current Linux repo is ~103MB with a much shorter history (27153 
commits).

Given the above we can estimate the size of the kernel repository after 
x commits as follows:

 slope = (175 - 103) / (63428 - 27153) = approx 2KB per commit

 initial size = 175 - .001985*63428 = 49MB

So the initial kernel commit is about 49MB in size which is coherent 
with the corresponding compressed tarball.  Subsequent commits are 2KB 
in size on average.

<b>Reference:</b> Nicolas Pitre's [http://permalink.gmane.org/gmane.comp.version-control.git/21531 email] on [[GitCommunity|[[GitMailingList]]]]

== Pack size vs number of commits of git repository ==

Fitting linear function to the size of pack (created <code><nowiki>git pack-objects</nowiki></code>) versus number of commit (number of lines returned by <code><nowiki>git rev-list $commit</nowiki></code>) for git repository (which is repository which starts from scratch, from two files, and not is imported project) gives around 1.2 kB per revision (per commit); 1.35 KB per revision if we add index size into account. The size of (gzipped) checkout is not substracted. Only mainline is taken into account.

 slope = 1.25 kB / revision (for git.git repository)

<b>Reference:</b> 
 [http://img522.imageshack.us/my.php?image=gitgitpacksizefullgq3.png http://img522.imageshack.us/img522/6973/gitgitpacksizefullgq3.th.png] <<BR>>
<i>(click on thumbnail to go to the plot)</i>

== Gains from deltaification: pack size vs size of tarballs ==

Comparison of an archive of all released Gnumeric versions versus git repository containing all released Gnumeric versions.

* Total size of 172 tar files: 1508026377 bytes.
* Total size of git archive: 139733921 bytes
* Ratio: 10.8

<b>Reference:</b> [http://blogs.gnome.org/mortenw/2007/01/07/10x-better-compression-than-gzip/ 10x+ Better Compression Than Gzip] blog entry <i>(from January 7th, 2007)</i>.

== Git, Mercurial, Bazaar repository size benchmark ==

As candidate repositories there were chosen three projects which use given version control system for each SCMs tested. The choice is explained in [http://vcscompare.blogspot.com/2008/05/meet-candidates.html DVCS Comparison: Meet the candidates] blog post.

For all repositories, only a single branch was converted. For all repositories except Samba, this meant the development branch. As Samba has multiple development branches, v3-3-test branch was chosen. Wnere possible fast-export/import interface was chosen.

After conversion, pack command was run for the repositories that support this feature. For Git, this meant a `git repack -adf â€”window=250`, for Bazaar it meant a `bzr pack`, and removing the obsolete packs. This means that the table below show size of <i>tightly packed repository</i>.

Tests were done using Git v1.5.5.3, Bzr v1.5, Hg v1.0

 ||<b><i>Repository</b></i>||<:> <b>Git</b> ||<:> <b>Mercurial</b> ||<:> <b>Bazaar</b> ||
 ||<rowstyle="background-color: #FFFFE0;">||<colspan=3 style="text-align: center; font-size=70%;"> <i>Git</i> ||
 || Cairo       ||<)>  15MB ||<)>	 24MB ||<)> 	 30MB ||
 || Coreutils   ||<)>  29MB ||<)>	 44MB ||<)>	 76MB ||
 || Samba	||<)>  82MB ||<)>	146MB ||<)>	310MB ||
 ||<rowstyle="background-color: #FFFFE0;">||<colspan=3 style="text-align: center; font-size=70%;"> <i>Mercurial</i> ||
 || Octave	||<)>  22MB ||<)>	 49MB ||<)>	 57MB ||
 || Mozilla	||<)>  78MB ||<)>	205MB ||<)>	255MB ||
 || Dovecot	||<)>   9MB ||<)>	 14MB ||<)>	 23MB ||
 ||<rowstyle="background-color: #FFFFE0;">||<colspan=3 style="text-align: center; font-size=70%;"> <i>Bazaar</i> ||
 || Emacs	||<)> 120MB ||<)>	163MB ||<)>	300MB ||
 || Mailman	||<)>  42MB ||<)>	 75MB ||<)>	 73MB ||
 || Pkgconfig	||<)> 1.1MB ||<)>	1.3MB ||<)>	1.8MB ||
 ||<-4 #80FF80>||
 || <i>Total</i>	||<)> 398MB ||<)>	721MB ||<)>       1125MB ||
 || <i>Relative</i>||<)>   1   ||<)>	1.8   ||<)>	   2.8   ||

As can be seen from the table, Git really is the most efficient in storing the data. Next up is Mercurial, which also does a nice job. Bazaar is the least efficient by far, taking on average 2.8 times the space of an equivalent Git repository.

<b>Reference:</b> [http://vcscompare.blogspot.com/2008/06/git-mercurial-bazaar-repository-size.html DVCS Comparison: Git, Mercurial, Bazaar Repository Size Benchmark] blog entry <i>(from June 1, 2008)</i>, from [http://vcscompare.blogspot.com/ DVCS Comparison] blog.

__NOTOC__